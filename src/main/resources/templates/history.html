<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Manage</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 4 -->

  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
  <link href="css/login.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">

  <style>
@charset "ISO-8859-1";

/* sign in FORM */
#logreg-forms {
	width: 400px;
	margin: 8% 35%;
	background-color: #f3f3f3;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
	transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
}

.table-dark tr th {
	text-align: center;
}

.table tbody tr th {
	text-align: center;
	vertical-align: middle;
}

.color-palette {
	height: 35px;
	line-height: 35px;
	text-align: right;
	padding-right: .75rem;
}

.color-palette.disabled {
	text-align: center;
	padding-right: 0;
	display: block;
}

.color-palette-set {
	margin-bottom: 15px;
}

.color-palette span {
	display: none;
	font-size: 12px;
}

.color-palette:hover span {
	display: block;
}

.color-palette.disabled span {
	display: block;
	text-align: left;
	padding-left: .75rem;
}

.color-palette-box h4 {
	position: absolute;
	left: 1.25rem;
	margin-top: .75rem;
	color: rgba(255, 255, 255, 0.8);
	font-size: 12px;
	display: block;
	z-index: 7;
}

.table-dark tr {
	height: 5px;
}

.reviews-pagination {
	text-align: center;
}

.reviews-pagination li {
	display: inline-block;
	width: 35px;
	height: 35px;
	line-height: 35px;
	text-align: center;
	background-color: #FFF;
	border: 1px solid #E4E7ED;
	-webkit-transition: 0.2s all;
	transition: 0.2s all;
}

.reviews-pagination li:hover {
	background-color: #E4E7ED;
	color: #D10024;
}

.reviews-pagination li.active {
	background-color: gray;
	border-color: gray;
	color: #FFF;
	cursor: default;
}

.reviews-pagination li a {
	display: block;
}

ul li a {
	text-decoration: none;
}
.filter {
    margin-left:20px;
	padding: 4px; /* Kích thước padding bên trong select */
	border: 1px solid gray; /* Viền xung quanh select */
	border-radius: 4px; /* Bo tròn viền của select */
	font-size: 15px; /* Kích thước chữ */
	background-color: #fff; /* Màu nền của select */
	color: #333; /* Màu chữ của select */
	appearance: none;
	/* Ẩn giao diện mặc định của select (đối với trình duyệt webkit-based) */
	cursor: pointer; /* Con trỏ khi hover qua select */
}

/* Tùy chỉnh giao diện cho tùy chọn option */
.filter option {
	font-size: 14px; /* Kích thước chữ */
	background-color: #fff; /* Màu nền của option */
	color: #333; /* Màu chữ của option */
}

/* Tùy chỉnh giao diện khi select được nhấp chọn */
.filter:focus {
	border-color: #007bff; /* Màu viền khi select được chọn */
	box-shadow: 0 0 5px rgb(64, 128, 128);
	/* Hiệu ứng bóng khi select được chọn */
}

#chartSelect option {
	font-size: 14px; /* Kích thước chữ */
	background-color: #fff; /* Màu nền của option */
	color: #333; /* Màu chữ của option */
}

/* Tùy chỉnh giao diện khi select được nhấp chọn */
#chartSelect:focus {
	border-color: #007bff; /* Màu viền khi select được chọn */
	box-shadow: 0 0 5px rgb(64, 128, 128);
	/* Hiệu ứng bóng khi select được chọn */
}

/* Tùy chỉnh giao diện khi hover qua option */
#chartSelect option:hover {
	background-color: #007bff; /* Màu nền khi hover qua option */
	color: #fff; /* Màu chữ khi hover qua option */
}

#page-numbers1 button {
	margin-right: 1px;
	margin-left: 1px;
	width: 30px;
}

#pagination1 {
	display: flex;
	justify-content: center;
	align-items: center;
	margin-top: 10px;
	/* Điều chỉnh khoảng cách giữa container và pagination theo ý muốn */
}

#pagination1 #page-numbers1 :active {
	background-color: gray;
}

#page-numbers1 button.active {
	border-color: gray !important;
	background-color: gray !important;
	color: white !important;
}

#page-numbers1 {
	display: flex;
	justify-content: center;
	align-items: center;
}

#page-numbers1 button {
	margin-right: 1px;
	margin-left: 1px;
	width: 30px;
	border: 1px solid black; /* Viền màu đen */
}

#page-numbers1 button.active {
	border-color: gray; /* Viền màu đỏ cho nút đã chọn */
	background-color: gray; /* Nền màu đỏ cho nút đã chọn */
	color: white; /* Màu chữ trắng cho nút đã chọn */
}

.page-number {
            margin: 0 3px;
            border: 1px solid black;
            padding: 2px 3px;
            cursor: pointer;
            background-color: white;
        }

        .page-number:hover {
            background-color: #E4E7ED;
        }

        .page-number.active,
#pagination1 .page-number:hover {
    background-color: gray;
    color: white;
}

</style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<!-- Navbar -->
		<nav class="main-header navbar navbar-expand navbar-white navbar-light" style="height: 45px; position: relative;">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a></li>
    </ul>
    
	
    <form style="position: absolute; right: calc(0px + 8px); top: 50%; transform: translateY(-50%);" class="form-inline ml-3">
        <div class="input-group input-group-sm">
            <input id="searchInput" style="box-shadow: none" class="form-control form-control-navbar" name="keyword" type="search" placeholder="Tìm theo họ tên" aria-label="Search" onkeypress="handleKeyPress(event)">
            <div class="input-group-append">
                <button class="btn btn-navbar" onclick="search()" type="button"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </form>
</nav>

		<!-- /.navbar -->

		<!-- Main Sidebar Container -->
		<aside class="main-sidebar sidebar-dark-primary elevation-4">
			<!-- Brand Logo -->
			<!-- Sidebar -->
			<div style="height: 430px" class="sidebar">
				<!-- Sidebar user panel (optional) -->
				<div class="user-panel mt-3 pb-3 mb-3 d-flex">
					<div class="image">
						<i style="margin-left: 9px;margin-top: 10px;color: white;" class="fa fa-user-circle nav-icon"></i>
					</div>
					<div class="info">
						<a href="#" class="d-block" style="text-decoration: none" th:if = "${session.account!=null}">[[${session.account.username}]]</a>
					</div>
				</div>

				<!-- Sidebar Menu -->
				<nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item has-treeview menu-open">
            <a style="background-color: rgb(32,178,170)" th:href="@{/admin}" class="nav-link active">
              <i class="fa fa-camera-retro nav-icon"></i>
              <p>
                Camera
              </p>
            </a>
          </li>      
          <li class="nav-item has-treeview menu-open">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-institution"></i>
              <p>
                Quản Lý
                <i class="fas fa-angle-left right"></i>
                <span class="badge badge-info right">1</span>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#" class="nav-link active">
                  <i class="fa fa-pencil-square-o nav-icon"></i>
                  <p>Lịch sử</p>
                </a>
              </li>     
            </ul>
          </li>
          <li class="nav-item">
                <a th:href="@{/logout}" class="nav-link">
                  <i class="fa fa-sign-out nav-icon"></i>
                  <p>Thoát</p>
                </a>
              </li> 
        </ul>
      </nav> 
				<!-- /.sidebar-menu -->
			</div>
			<!-- /.sidebar -->
		</aside>

		<div class="content-wrapper">
		<div id="blockEmpty" style="display: none;">
           <h2 style="text-align: center; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center;">Không tìm thấy dữ liệu</h2>
        </div>
       <div id="blockTable" class="container">   
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>STT</th>
                <th>Họ và tên</th>
                <th>Mã số thuế</th>
                <th>Điện thoại</th>
                <th>Địa chỉ</th>
                <th>Lịch sử thuế</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div id="blockPagination">
    	<div id="pagination1">
        <button style="border-color: gray;" onclick="prevPage1()">Trang trước</button>
        <span id="page-numbers1"></span>
        <button style="border-color: gray;" onclick="nextPage1()">Trang sau</button>
    </div>
    </div>
</div>

		<aside class="control-sidebar control-sidebar-dark">
			<!-- Control sidebar content goes here -->
		</aside>
		<!-- /.control-sidebar -->
	</div>

<!-- jQuery -->
<script src="../../plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>

</body>
<script>
var currentPageButton = null;
var fetchedData = [];
var currentPage = 1;

var url = '/list/person/' + encodeURIComponent(address) + '/' + encodeURIComponent(income);

fetch(url)
    .then(response => response.json())
    .then(data => {
        fetchedData = data;
        checkLengthData(fetchedData);
        showPage(currentPage);
    })
    .catch(error => {
        console.error('Error:', error);
    });
function checkLengthData(fetchedData){
	if (fetchedData.length === 0) {
        document.getElementById('blockEmpty').style.display = 'block';
        document.getElementById('blockTable').style.display = 'none';
        return;
    } else {
        document.getElementById('blockEmpty').style.display = 'none';
        document.getElementById('blockTable').style.display = 'block';
    }
}

function search() {
	var selectElement = document.getElementById('address');

	// Chọn giá trị cho dropdown list
	var selectedValue = 'Chọn tỉnh'; // Thay bằng giá trị mà bạn muốn chọn

	// Duyệt qua từng phần tử option trong select
	for (var i = 0; i < selectElement.options.length; i++) {
	    // So sánh giá trị của option với giá trị được chọn
	    if (selectElement.options[i].text === selectedValue) {
	        // Nếu trùng, đặt thuộc tính selected của option đó thành true
	        selectElement.options[i].selected = true;
	        // Thoát khỏi vòng lặp vì đã tìm được giá trị cần chọn
	        break;
	    }
	}
	
	var selectElement = document.getElementById('income');

	// Chọn giá trị cho dropdown list
	var selectedValue = 'Chọn mức thu nhập'; // Thay bằng giá trị mà bạn muốn chọn

	// Duyệt qua từng phần tử option trong select
	for (var i = 0; i < selectElement.options.length; i++) {
	    // So sánh giá trị của option với giá trị được chọn
	    if (selectElement.options[i].text === selectedValue) {
	        // Nếu trùng, đặt thuộc tính selected của option đó thành true
	        selectElement.options[i].selected = true;
	        // Thoát khỏi vòng lặp vì đã tìm được giá trị cần chọn
	        break;
	    }
	}
    // Lấy giá trị từ trường input có name="keyword"
    var keyword = document.querySelector('input[name="keyword"]').value;
    
    // Tạo URL API để gửi yêu cầu lấy dữ liệu
    var apiUrl = '/list/person/' + encodeURIComponent(keyword);
    
    // Gửi yêu cầu AJAX đến API
    fetch(apiUrl)
    .then(response => response.json())
    .then(data => {
        fetchedData = data;
        checkLengthData(fetchedData);
        showPage(currentPage);
    })
    .catch(error => {
        console.error('Error:', error);
    });
    function checkLengthData(fetchedData){
    	if (fetchedData.length === 0) {
            document.getElementById('blockEmpty').style.display = 'block';
            document.getElementById('blockTable').style.display = 'none';
            return;
        } else {
            document.getElementById('blockEmpty').style.display = 'none';
            document.getElementById('blockTable').style.display = 'block';
        }
    }
};

function handleKeyPress(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        search();
    }
}


function showPage(pageNumber) {
    var tableBody = document.querySelector('tbody');
    tableBody.innerHTML = '';

    var rowsPerPage = 11;
    var startIndex = (pageNumber - 1) * rowsPerPage;
    var endIndex = startIndex + rowsPerPage;
    var currentPageData = fetchedData.slice(startIndex, endIndex);

    currentPage = pageNumber;
    if (currentPageData.length === 0) {
        document.getElementById('blockPagination').style.display = 'none';
        return;
    } else {
        document.getElementById('blockPagination').style.display = 'block';
    }

    currentPageData.forEach(function(person, index) {
        var row = '<tr>';
        row += '<th>' + (startIndex + index + 1) + '</th>';
        row += '<th>' + person.name + '</th>';
        row += '<th>' + person.taxCode + '</th>';
        row += '<th>' + person.phoneNumber + '</th>';
        row += '<th>' + person.address + '</th>';
        row += '<th><a href="/history/' + person.id + '">Xem</a></th>';
        row += '</tr>';
        tableBody.innerHTML += row;
    });

    updatePagination();

    // Gọi hàm selectPage để chọn ô số trang hiện tại
    if (currentPageButton !== null) {
        selectPage(currentPageButton);
    }
}

function renderPageNumbers(totalPages) {
    var pageNumberContainer = document.getElementById('page-numbers1');
    pageNumberContainer.innerHTML = '';

    for (var i = 1; i <= totalPages; i++) {
        var button = document.createElement('button');
        button.textContent = i;
        button.classList.add('page-number');
        button.onclick = function() {
            showPage(parseInt(this.textContent));
        };
        pageNumberContainer.appendChild(button);
    }
}

function updatePagination() {
    var totalPages = Math.ceil(fetchedData.length / 11);
    renderPageNumbers(totalPages);

    var pageButtons = document.querySelectorAll('#page-numbers1 button');
    pageButtons.forEach(function(button, index) {
        if (index + 1 === currentPage) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
}


function prevPage1() {
    if (currentPage > 1) {
        showPage(currentPage - 1);
    }
}

function nextPage1() {
    var totalPages = Math.ceil(fetchedData.length / 11);
    if (currentPage < totalPages) {
        showPage(currentPage + 1);
    }
}

function selectPage(pageNumberButton) {
    // Loại bỏ lớp 'active' khỏi ô số trang hiện tại
    if (currentPageButton !== null) {
        currentPageButton.classList.remove('active');
    }
    // Thêm lớp 'active' vào ô số trang mới được chọn
    pageNumberButton.classList.add('active');
    // Lưu trữ ô số trang mới được chọn
    currentPageButton = pageNumberButton;
}

showPage(currentPage);

</script>

</html>